#!/bin/bash
#------------------------------------------------------------------------------
# File:   /usr/local/bin/knode-limits
# Author: Matt Burdan <burdz@burdz.net>
#------------------------------------------------------------------------------

#------------------------------------------------------------------------------
# print the requsts/limits in a given k8s cluster
#------------------------------------------------------------------------------

set -euo pipefail

kubectl "$@" describe nodes -l gravitational.io/k8s-role=node \
    | grep 'CPU Limits\|%' \
    | sed -e 's/\(CPU\|Memory\) /\1_/g' -e 's/ (/_(/g' \
    | column -t \
    | sort -ur \
    | sed -e 's/_/ /g'
